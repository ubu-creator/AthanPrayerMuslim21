<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TowMes - Mobile & Tablet Pro</title>
    
    <style>
        /* --- الأساسيات ونظام التمرير الذكي --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%; height: 100%;
            overflow-x: hidden; /* منع الاهتزاز يميناً ويساراً */
            overflow-y: auto;   /* تفعيل التمرير للأعلى والأسفل */
            background-color: #050505;
            font-family: 'Segoe UI', Tahoma, sans-serif;
        }

        /* تخصيص شكل شريط التمرير ليكون مخفياً وجميلاً */
        body::-webkit-scrollbar { width: 5px; }
        body::-webkit-scrollbar-thumb { background: #ff0000; border-radius: 10px; }

        body {
            display: flex; flex-direction: column; align-items: center;
            background: radial-gradient(circle at center, #1a202c 0%, #050505 100%);
            min-height: 100vh; padding: 20px 0;
            position: relative;
        }

        /* --- طبقة الخلفية الثابتة --- */
        .bg-fixed {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
        }
        .cloud {
            position: absolute; width: 200px; opacity: 0.1;
            filter: blur(2px); animation: moveClouds linear infinite;
        }
        @keyframes moveClouds { from { left: -250px; } to { left: 110vw; } }
        
        .moon-icon {
            position: fixed; top: 20px; left: 20px; width: 50px;
            filter: drop-shadow(0 0 10px #fbbf24); z-index: 2;
        }
        .kaaba-img {
            position: fixed; bottom: -5px; left: 50%;
            transform: translateX(-50%); width: 100%; max-width: 500px;
            opacity: 0.15; z-index: 1;
        }

        /* --- حاوية التطبيق الرئيسية --- */
        .main-card {
            position: relative; z-index: 10;
            width: 90%; max-width: 420px;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 40px;
            padding: 2rem 1.5rem;
            border: 2px solid rgba(255, 0, 0, 0.5); 
            box-shadow: 0 40px 80px rgba(0,0,0,0.8);
            text-align: center;
            margin-bottom: 20px; /* مساحة في الأسفل عند التمرير */
        }

        .brand-name {
            font-size: 2.2rem; font-weight: 900;
            color: #ff0000; text-transform: uppercase;
            letter-spacing: 4px; margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        /* ساعة متوسطة الحجم لراحة العين */
        .clock-box {
            background: rgba(255, 0, 0, 0.05);
            border-radius: 20px; padding: 10px; margin-bottom: 15px;
        }
        .digital-clock {
            font-size: 3rem; font-weight: 800;
            color: #ffffff; line-height: 1;
            font-variant-numeric: tabular-nums;
        }
        .date-txt {
            color: #ff4d4d; font-size: 1rem; font-weight: bold;
            display: block; margin-top: 5px;
        }

        /* --- قائمة مواقيت الصلاة --- */
        .prayer-list {
            display: flex; flex-direction: column; gap: 12px;
            margin-bottom: 25px;
        }
        .prayer-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: rgba(255, 255, 255, 0.04);
            border-radius: 18px; border: 1px solid rgba(255, 0, 0, 0.15);
            transition: 0.3s;
        }
        .active-row {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0000; transform: scale(1.02);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
        }
        .p-info { text-align: right; }
        .p-ar { font-size: 1.3rem; font-weight: 800; color: #ff0000; }
        .p-en { font-size: 0.8rem; color: #777; text-transform: uppercase; }
        .p-time { font-size: 1.4rem; font-weight: 700; color: #fff; }

        /* --- الأزرار وأدوات التحكم --- */
        .ui-section { display: flex; flex-direction: column; gap: 12px; }
        
        select {
            width: 100%; padding: 15px; border-radius: 15px;
            background: #111; color: #ff0000; border: 1px solid #ff0000;
            font-size: 1rem; font-weight: bold; outline: none; cursor: pointer;
            text-align: center;
        }

        .btn-start {
            width: 100%; padding: 18px; border-radius: 18px; border: none;
            background: linear-gradient(135deg, #ff0000, #900000);
            color: #fff; font-size: 1.2rem; font-weight: 900;
            cursor: pointer; box-shadow: 0 10px 20px rgba(255, 0, 0, 0.4);
        }
        .btn-start:active { transform: scale(0.98); }

        .sys-status { font-size: 0.8rem; color: #666; margin-top: 15px; }
        .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: #333; margin-left: 5px; }
        .dot.active { background: #00ff00; box-shadow: 0 0 10px #00ff00; }
    </style>
</head>
<body onclick="enableAudio()">

    <div class="bg-fixed" id="cloud-container"></div>
    <img src="https://cdn-icons-png.flaticon.com/512/1823/1823330.png" class="moon-icon">
    <img src="https://pngimg.com/d/kaaba_PNG10.png" class="kaaba-img">

    <div class="main-card">
        <div class="brand-name">TowMes</div>
        
        <div class="clock-box">
            <div class="digital-clock" id="clock-view">00:00:00</div>
            <span class="date-txt" id="date-view">جاري جلب البيانات...</span>
        </div>

        <div class="prayer-list" id="prayer-rows">
            </div>

        <div class="ui-section">
            <select id="voice-picker" onchange="switchVoice()">
                <option value="https://www.islamcan.com/audio/adhan/azan1.mp3">المؤذن الأول (عبد الباسط)</option>
                <option value="https://www.islamcan.com/audio/adhan/azan5.mp3">المؤذن الثاني (المنشاوي)</option>
                <option value="https://www.islamcan.com/audio/adhan/azan3.mp3">المؤذن الثالث (العفاسي)</option>
                <option value="https://www.islamcan.com/audio/adhan/azan4.mp3">المؤذن الرابع (الغامدي)</option>
                <option value="https://www.islamcan.com/audio/adhan/azan6.mp3">المؤذن الخامس (الكزبري)</option>
            </select>

            <button class="btn-start" id="run-btn">تفعيل الأذان التلقائي</button>
        </div>

        <div class="sys-status">
            TowMes System: <span id="status-label">في انتظارك</span>
            <div class="dot" id="status-dot"></div>
        </div>
    </div>

    <script>
        let adhanPlayer = new Audio();
        let timings = {};
        let isActivated = false;
        let playedFor = "";

        // توليد سحاب خلفية
        function makeClouds() {
            const bg = document.getElementById('cloud-container');
            for(let i=0; i<6; i++) {
                const cloud = document.createElement('img');
                cloud.src = "https://www.pngmart.com/files/15/Vector-Cloud-PNG-Transparent-Image.png";
                cloud.className = 'cloud';
                cloud.style.top = (Math.random() * 80) + "%";
                cloud.style.animationDuration = (40 + Math.random() * 30) + "s";
                cloud.style.animationDelay = (i * 4) + "s";
                bg.appendChild(cloud);
            }
        }

        // الموقع والبيانات
        async function boot() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    p => loadPrayers(p.coords.latitude, p.coords.longitude),
                    () => loadPrayers(21.42, 39.82)
                );
            }
        }

        async function loadPrayers(lat, lng) {
            const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lng}&method=4`);
            const data = await res.json();
            timings = data.data.timings;
            document.getElementById('date-view').innerText = data.data.date.readable;
            renderList();
        }

        function renderList() {
            const map = {'Fajr':'الفجر', 'Dhuhr':'الظهر', 'Asr':'العصر', 'Maghrib':'المغرب', 'Isha':'العشاء'};
            const container = document.getElementById('prayer-rows');
            container.innerHTML = '';
            Object.keys(map).forEach(key => {
                container.innerHTML += `
                    <div class="prayer-row" id="p-${key}">
                        <div class="p-info">
                            <div class="p-ar">${map[key]}</div>
                            <div class="p-en">${key}</div>
                        </div>
                        <div class="p-time">${timings[key]}</div>
                    </div>
                `;
            });
        }

        function enableAudio() {
            if(!isActivated) {
                switchVoice();
                adhanPlayer.play().then(() => {
                    adhanPlayer.pause();
                    isActivated = true;
                    document.getElementById('status-dot').classList.add('active');
                    document.getElementById('status-label').innerText = "مفعل وشغال";
                    document.getElementById('run-btn').style.display = 'none';
                });
            }
        }

        function switchVoice() {
            adhanPlayer.src = document.getElementById('voice-picker').value;
            adhanPlayer.load();
        }

        function update() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clock-view').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false});

            ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].forEach(p => {
                const el = document.getElementById(`p-${p}`);
                if(timings[p] === timeStr) {
                    if(el) el.classList.add('active-row');
                    if(isActivated && playedFor !== p) {
                        adhanPlayer.play();
                        playedFor = p;
                    }
                } else { if(el) el.classList.remove('active-row'); }
            });
            if(timeStr === "00:00") playedFor = "";
        }

        window.onload = () => { makeClouds(); boot(); setInterval(update, 1000); };
    </script>
</body>
</html>
