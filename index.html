<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TowMes - Global Athan</title>
    <link rel="manifest" href="data:application/manifest+json,{'name':'TowMes','short_name':'TowMes','start_url':'.','display':'standalone'}" />
    
    <style>
        :root { --gold: #fbbf24; --white: #f8fafc; --glass: rgba(30, 41, 59, 0.8); }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #0f172a, #1e293b);
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
            overflow: hidden; position: relative; color: white;
        }

        /* Moving Background Elements */
        .cloud-env { position: absolute; top: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .cloud { position: absolute; width: 250px; opacity: 0.2; animation: move 40s linear infinite; }
        @keyframes move { from { left: -300px; } to { left: 100vw; } }
        .moon { position: absolute; top: 30px; left: 30px; width: 60px; filter: drop-shadow(0 0 10px var(--gold)); opacity: 0.8; }
        .kaaba { position: absolute; bottom: -20px; width: 100%; max-width: 450px; opacity: 0.15; z-index: 0; pointer-events: none; }

        /* Main App Card */
        .app-card {
            position: relative; background: var(--glass); backdrop-filter: blur(12px);
            padding: 2rem; border-radius: 30px; box-shadow: 0 25px 50px rgba(0,0,0,0.7);
            width: 88%; max-width: 380px; text-align: center; z-index: 10;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }
        .brand { font-size: 1.5rem; color: var(--gold); font-weight: bold; margin-bottom: 10px; letter-spacing: 2px; }
        .clock { font-size: 3.5rem; font-weight: bold; color: var(--gold); margin: 5px 0; }
        
        /* Prayer List Styling */
        .prayer-list { margin: 20px 0; direction: rtl; }
        .prayer-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; margin: 8px 0; background: rgba(255,255,255,0.05);
            border-radius: 12px; transition: 0.3s;
        }
        .active { border: 1.5px solid var(--gold); background: rgba(251, 191, 36, 0.15); box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); }
        .p-name { font-weight: bold; }
        .p-name span { font-size: 0.8rem; color: #94a3b8; margin-right: 5px; }

        /* Controls */
        select, button {
            width: 100%; padding: 12px; margin-top: 10px; border-radius: 12px;
            border: none; font-weight: bold; cursor: pointer;
        }
        select { background: #334155; color: white; font-size: 0.9rem; }
        button { background: var(--gold); color: #0f172a; font-size: 1rem; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        .status-text { font-size: 0.75rem; color: #94a3b8; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="cloud-env">
        <img src="https://www.pngmart.com/files/15/Vector-Cloud-PNG-Transparent-Image.png" class="cloud" style="top:10%; animation-duration: 45s;">
        <img src="https://www.pngmart.com/files/15/Vector-Cloud-PNG-Transparent-Image.png" class="cloud" style="top:30%; animation-duration: 30s;">
    </div>
    
    <img src="https://cdn-icons-png.flaticon.com/512/1823/1823330.png" class="moon">
    <img src="https://pngimg.com/d/kaaba_PNG10.png" class="kaaba">

    <div class="app-card">
        <div class="brand">TowMes</div>
        <div class="clock" id="time">00:00</div>
        <div id="date" style="color: #94a3b8; font-size: 0.9rem;">-- -- ----</div>

        <div class="prayer-list" id="list">
            </div>

        <select id="moazin">
            <option value="https://www.islamcan.com/audio/adhan/azan1.mp3">عبد الباسط عبد الصمد</option>
            <option value="https://www.islamcan.com/audio/adhan/azan5.mp3">محمد صديق المنشاوي</option>
            <option value="https://www.islamcan.com/audio/adhan/azan3.mp3">مشاري العفاسي</option>
            <option value="https://www.islamcan.com/audio/adhan/azan4.mp3">سعد الغامدي</option>
            <option value="https://www.islamcan.com/audio/adhan/azan6.mp3">عمر الكزبري</option>
        </select>

        <button onclick="unlockAudio()">تفعيل الأذان التلقائي / Activate</button>
        <div class="status-text" id="status">الصوت متوقف | Audio Muted</div>
    </div>

    <script>
        let athan = new Audio();
        let prayers = {};
        let canPlay = false;

        async function start() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    p => loadTimes(p.coords.latitude, p.coords.longitude),
                    () => loadTimes(21.42, 39.82) // Fallback to Mecca
                );
            }
        }

        async function loadTimes(lat, lng) {
            const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lng}&method=4`);
            const data = await res.json();
            prayers = data.data.timings;
            document.getElementById('date').innerText = data.data.date.readable;
            displayUI();
        }

        function displayUI() {
            const names = {
                'Fajr': 'الفجر', 'Dhuhr': 'الظهر', 'Asr': 'العصر', 
                'Maghrib': 'المغرب', 'Isha': 'العشاء'
            };
            const container = document.getElementById('list');
            container.innerHTML = '';
            ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].forEach(p => {
                container.innerHTML += `
                    <div class="prayer-item" id="p-${p}">
                        <div class="p-name">${names[p]} <span>${p}</span></div>
                        <div style="color:var(--gold); font-weight:bold;">${prayers[p]}</div>
                    </div>
                `;
            });
        }

        function unlockAudio() {
            athan.src = document.getElementById('moazin').value;
            athan.play().then(() => {
                athan.pause();
                canPlay = true;
                document.getElementById('status').innerText = "✅ النظام يعمل تلقائياً | Auto-Athan Ready";
            });
        }

        function sync() {
            const now = new Date();
            const nowTime = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('time').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false});

            ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].forEach(p => {
                if (prayers[p] === nowTime && canPlay) {
                    athan.play();
                    canPlay = false; // Block repeat
                    setTimeout(() => canPlay = true, 61000);
                }
                // Update active highlight
                const el = document.getElementById(`p-${p}`);
                if (prayers[p] === nowTime) el.classList.add('active');
                else if (el) el.classList.remove('active');
            });
        }

        setInterval(sync, 1000);
        window.onload = start;
    </script>
</body>
</html>
