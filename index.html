<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TowMesÂ©â„¢ - Professional Athan System</title>
    
    <style>
        /* --- Ù†ÙÙÙ’Ø³Ù Ø§Ù„ØªÙ‘ÙØµÙ’Ù…ÙÙŠÙ…Ù Ø§Ù„Ø­ÙØ§Ù„ÙÙŠÙ‘Ù Ù…ÙØ¹Ù ØªÙØ­Ù’Ø³ÙÙŠÙ†Ø§ØªÙ Ø§Ù„Ù…ÙØ³ÙØ§Ø­ÙØ©Ù --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%; height: 100%;
            overflow-x: hidden; overflow-y: auto;
            background-color: #050505;
            font-family: 'Segoe UI', Tahoma, sans-serif;
        }

        body {
            display: flex; flex-direction: column; align-items: center;
            background: radial-gradient(circle at center, #1a202c 0%, #050505 100%);
            min-height: 100vh; padding: 20px 0;
            position: relative;
        }

        .bg-fixed { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        .cloud { position: absolute; width: 200px; opacity: 0.1; animation: moveClouds linear infinite; }
        @keyframes moveClouds { from { left: -250px; } to { left: 110vw; } }
        
        .moon-icon { position: fixed; top: 20px; left: 20px; width: 50px; filter: drop-shadow(0 0 10px #fbbf24); z-index: 2; }
        .kaaba-img { position: fixed; bottom: -5px; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; opacity: 0.12; z-index: 1; }

        .main-card {
            position: relative; z-index: 10;
            width: 90%; max-width: 420px;
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-radius: 40px; padding: 1.8rem 1.5rem;
            border: 2px solid rgba(255, 0, 0, 0.5); 
            box-shadow: 0 40px 80px rgba(0,0,0,0.8);
            text-align: center; margin-bottom: 30px;
        }

        .brand-name {
            font-size: 2rem; font-weight: 900;
            color: #ff0000; letter-spacing: 2px; margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .clock-box { background: rgba(255, 0, 0, 0.05); border-radius: 20px; padding: 10px; margin-bottom: 15px; }
        .digital-clock { font-size: 2.8rem; font-weight: 800; color: #fff; font-variant-numeric: tabular-nums; }
        .date-txt { color: #ff4d4d; font-size: 0.9rem; font-weight: bold; }

        .prayer-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .prayer-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 18px; background: rgba(255, 255, 255, 0.04);
            border-radius: 15px; border: 1px solid rgba(255, 0, 0, 0.1);
        }
        .active-row { background: rgba(255, 0, 0, 0.2); border-color: #ff0000; box-shadow: 0 0 15px rgba(255, 0, 0, 0.3); }
        .p-ar { font-size: 1.1rem; font-weight: 800; color: #ff0000; }
        .p-time { font-size: 1.3rem; font-weight: 700; color: #fff; }

        .ui-section { display: flex; flex-direction: column; gap: 10px; }
        
        select {
            width: 100%; padding: 12px; border-radius: 12px;
            background: #111; color: #ff0000; border: 1px solid #ff0000;
            font-size: 0.9rem; font-weight: bold; outline: none; text-align: center;
        }

        .btn-start {
            width: 100%; padding: 16px; border-radius: 15px; border: none;
            background: linear-gradient(135deg, #ff0000, #900000);
            color: #fff; font-size: 1.1rem; font-weight: 900; cursor: pointer;
        }

        .sys-status { font-size: 0.75rem; color: #666; margin-top: 10px; }
        .dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #333; margin-left: 5px; }
        .dot.active { background: #00ff00; box-shadow: 0 0 8px #00ff00; }
    </style>
</head>
<body onclick="initAll()">

    <div class="bg-fixed" id="cloud-container"></div>
    <img src="https://cdn-icons-png.flaticon.com/512/1823/1823330.png" class="moon-icon">
    <img src="https://pngimg.com/d/kaaba_PNG10.png" class="kaaba-img">

    <div class="main-card">
        <div class="brand-name">TowMesÂ©â„¢</div>
        
        <div class="clock-box">
            <div class="digital-clock" id="clock-view">00:00:00</div>
            <span class="date-txt" id="date-view">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</span>
        </div>

        <div class="ui-section" style="margin-bottom: 15px;">
            <select id="country-picker" onchange="manualLocation()">
                <option value="AUTO">ğŸ“ ØªØ­Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ (GPS)</option>
                <option value="SA">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                <option value="MA">Ø§Ù„Ù…ØºØ±Ø¨</option>
                <option value="EG">Ù…ØµØ±</option>
                <option value="DZ">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
                <option value="AE">Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
                <option value="KW">Ø§Ù„ÙƒÙˆÙŠØª</option>
                <option value="QA">Ù‚Ø·Ø±</option>
                <option value="JO">Ø§Ù„Ø£Ø±Ø¯Ù†</option>
                <option value="TR">ØªØ±ÙƒÙŠØ§</option>
                <option value="FR">ÙØ±Ù†Ø³Ø§</option>
                <option value="ES">Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§</option>
            </select>
        </div>

        <div class="prayer-list" id="prayer-rows"></div>

        <div class="ui-section">
            <select id="voice-picker" onchange="switchVoice()">
                <option value="https://www.islamcan.com/audio/adhan/azan1.mp3">Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯</option>
                <option value="https://www.islamcan.com/audio/adhan/azan5.mp3">Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ</option>
                <option value="https://www.islamcan.com/audio/adhan/azan3.mp3">Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</option>
            </select>
            <button class="btn-start" id="run-btn">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù† ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
        </div>

        <div class="sys-status">
            TowMesÂ©â„¢ System: <span id="status-label">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„</span>
            <div class="dot" id="status-dot"></div>
        </div>
    </div>

    <script>
        let adhanPlayer = new Audio();
        let timings = {};
        let isActivated = false;
        let playedFor = "";

        // Ø§Ù„Ø³Ø­Ø§Ø¨
        function makeClouds() {
            const bg = document.getElementById('cloud-container');
            for(let i=0; i<5; i++) {
                const cloud = document.createElement('img');
                cloud.src = "https://www.pngmart.com/files/15/Vector-Cloud-PNG-Transparent-Image.png";
                cloud.className = 'cloud';
                cloud.style.top = (i * 20) + "%";
                cloud.style.animationDuration = (35 + Math.random() * 20) + "s";
                bg.appendChild(cloud);
            }
        }

        // Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function requestNotify() {
            if ("Notification" in window) {
                Notification.requestPermission();
            }
        }

        function sendNotify(prayerName) {
            if (Notification.permission === "granted") {
                new Notification("Ø­Ø§Ù† Ø§Ù„Ø¢Ù† Ù…ÙˆØ¹Ø¯ ØµÙ„Ø§Ø© " + prayerName, {
                    body: "ØªØ·Ø¨ÙŠÙ‚ TowMesÂ©â„¢ ÙŠØ°ÙƒØ±Ùƒ Ø¨Ø§Ù„ØµÙ„Ø§Ø©",
                    icon: "https://cdn-icons-png.flaticon.com/512/1823/1823330.png"
                });
            }
        }

        // Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function boot(lat = 21.42, lng = 39.82) {
            const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lng}&method=4`);
            const data = await res.json();
            timings = data.data.timings;
            document.getElementById('date-view').innerText = data.data.date.readable;
            renderList();
        }

        function manualLocation() {
            const country = document.getElementById('country-picker').value;
            if(country === "AUTO") {
                navigator.geolocation.getCurrentPosition(p => boot(p.coords.latitude, p.coords.longitude));
            } else {
                // Ù…ÙØ­Ù’ÙˆÙØ±Ù ØªÙÙ‚Ù’Ø¯ÙÙŠØ±ÙÙŠÙ‘Ù Ù„ÙÙ„Ø¯Ù‘ÙÙˆÙÙ„Ù (Capital Cities Fallback)
                const coords = { 'SA':[24.71, 46.67], 'MA':[34.02, -6.83], 'EG':[30.04, 31.23], 'DZ':[36.75, 3.05], 'AE':[24.45, 54.37] };
                const c = coords[country] || [21.42, 39.82];
                boot(c[0], c[1]);
            }
        }

        function renderList() {
            const map = {'Fajr':'Ø§Ù„ÙØ¬Ø±', 'Dhuhr':'Ø§Ù„Ø¸Ù‡Ø±', 'Asr':'Ø§Ù„Ø¹ØµØ±', 'Maghrib':'Ø§Ù„Ù…ØºØ±Ø¨', 'Isha':'Ø§Ù„Ø¹Ø´Ø§Ø¡'};
            const container = document.getElementById('prayer-rows');
            container.innerHTML = '';
            Object.keys(map).forEach(key => {
                container.innerHTML += `
                    <div class="prayer-row" id="p-${key}">
                        <div class="p-ar">${map[key]}</div>
                        <div class="p-time">${timings[key]}</div>
                    </div>
                `;
            });
        }

        function initAll() {
            if(!isActivated) {
                switchVoice();
                requestNotify();
                adhanPlayer.play().then(() => {
                    adhanPlayer.pause();
                    isActivated = true;
                    document.getElementById('status-dot').classList.add('active');
                    document.getElementById('status-label').innerText = "Ù…ÙØ¹Ù„ ØªÙ…Ø§Ù…Ø§Ù‹";
                    document.getElementById('run-btn').innerText = "Ù†Ø¸Ø§Ù… TowMesÂ©â„¢ ÙŠØ¹Ù…Ù„";
                    document.getElementById('run-btn').style.background = "#059669";
                });
            }
        }

        function switchVoice() {
            adhanPlayer.src = document.getElementById('voice-picker').value;
            adhanPlayer.load();
        }

        function update() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clock-view').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false});

            ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].forEach(p => {
                const el = document.getElementById(`p-${p}`);
                if(timings[p] === timeStr) {
                    if(el) el.classList.add('active-row');
                    if(isActivated && playedFor !== p) {
                        adhanPlayer.play();
                        sendNotify(document.querySelector(`#p-${p} .p-ar`).innerText);
                        playedFor = p;
                    }
                } else { if(el) el.classList.remove('active-row'); }
            });
        }

        window.onload = () => {
            makeClouds();
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => boot(p.coords.latitude, p.coords.longitude), () => boot());
            } else { boot(); }
            setInterval(update, 1000);
        };
    </script>
</body>
</html>
